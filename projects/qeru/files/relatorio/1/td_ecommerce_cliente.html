<input id="entidadeprincipalid" name="entidadeprincipalid" type="hidden" value="79" /><input id="funcionalidadetd" name="funcionalidadetd" type="hidden" value="relatorio" /><div class="row"><div class="bloco col-md-12"><p class="titulo-pagina">Relat√≥rio de Cliente</p></div></div><div class="row"><div class="col-md-12" id="crud-contexto-add-td_ecommerce_cliente"><button class="btn btn-primary b-imprimir" id="imprimir-relatorio"><span class="fas fa-print"></span> Imprimir</button><form class="form-horizontal tdform" onsubmit="return false" id="form-relatorio"><div class="form-grupo-botao"><div class="loader-salvar"><img class="loading2" src="http://localhost/villafrancioni.com.br/miles/core/tema/desktop/loading2.gif" /></div></div><fieldset><div class="row-fluid form_campos tdform"></div></fieldset></form></div></div><div class="row"><div class="col-md-12"><hr></hr></div></div><div class="row"><div class="col-md-12"><div id="crud-contexto-listar-td_ecommerce_cliente"></div></div></div><script type="text/javascript">
		var entidadeID 	= 79;
		var campos 		= "";
		
		$("#imprimir-relatorio").click(function(){
			var filtros 			= "";
			var urlpersonalizada 	= "";

			if ($("#form-relatorio.tdform .form_campos .form-control").length >0){
				$("#form-relatorio.tdform .form_campos .form-control").each(function(){
					if ($(this).hasClass("input-sm") || $(this).hasClass("termo-filtro") || $(this).hasClass("checkbox-sn")){
						if ($(this).val() != "" && $(this).val() != undefined && $(this).val() != null){
							var atributo = $(this).attr("id");
							if ($(this).data("operador") == ".."){
								var operador = atributo.split("-")[1] == "inicial"?">=":"<=";
							}else{
								var operador = $(this).data("operador");
							}
							var tipo = $(this).data("tipo");
							
							var filtro = atributo+"^"+operador+"^"+$(this).val()+"^"+tipo;
							filtros += (filtros == ""?"":"~") + filtro;
						}
					}
				});
				$.ajax({
					url:config.urlrelatorio,
					data:{
						entidade:entidadeID,
						filtros:filtros
					},
					complete:function(){
						
						var parametros = "&entidade=" + entidadeID + "&currentproject=" + session.projeto
						+ "&filtros=" + filtros
						+ "&campos=" + campos;
						
						if (urlpersonalizada == ""){
							window.open(config.urlrelatorio +  parametros,"_blank");
						}else{
							window.open(urlpersonalizada + (urlpersonalizada.indexOf("?") >= 0?"&":"?") + "filtros=" + filtros,"_blank");
						}
					}
				});				
			}else{
				$.ajax({
					url:config.urlrelatorio,
					data:{
						entidade:entidadeID
					},
					complete:function(){
						var parametros = "&entidade=" + entidadeID + "&currentproject=" + session.projeto
						+ "&campos=" + campos;
						window.open(config.urlrelatorio +  parametros,"_blank");
					}
				});
			}
		});
		var i = 1;
		for (f in td_relatorio[1].filtros){
			var ft = td_relatorio[1].filtros[f];			
			$("#form-relatorio .form-control[atributo="+ft.atributo+"]").attr("data-operador",ft.operador);
			$("#form-relatorio .form-control[atributo="+ft.atributo+"]").attr("data-tipo",td_atributo[ft.atributo].tipo);
			i++;
		}
		for (c in td_atributo){
			if (td_atributo[c].entidade == entidadeID && td_atributo[c].exibirgradededados == 1){
				if (parseInt(td_atributo[c].chaveestrangeira) > 0){
					var fk = td_entidade[td_atributo[c].chaveestrangeira].nome;
				}else{
					var fk = "";
				}
				campos += (campos==""?"":",") + td_atributo[c].nome + "^" + td_atributo[c].descricao + "^" + fk;
			}
		}
	</script>